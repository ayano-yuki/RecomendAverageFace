# Recomend1: アニメ推し度×レビュー ハイブリッドレコメンドシステム

## 概要

本プロジェクトは、ユーザーの推しキャラの平均顔画像の特徴量とアニメキャラクターの平均顔特徴量との類似度、さらにアニメのレビュー評価やジャンル好みなど複数の観点を組み合わせて、"推しになりうるキャラがいる未視聴アニメ"を高精度でレコメンドするシステムです。

---

## ディレクトリ構成

- `main.py` : レコメンドロジック本体
- `Dockerfile` : Docker実行用
- `requirements.txt` : 必要パッケージ
- 各種CSVファイル（データ）

---

## 各CSVファイルの内容と列の意味

### 1. `characters.csv`（キャラ-アニメ対応表）
| 列名           | 意味                         |
|----------------|------------------------------|
| character_id   | キャラクターID（数値）       |
| character_name | キャラクター名               |
| anime_id       | アニメID（数値）             |
| anime_title    | アニメタイトル               |

### 2. `anime_genres.csv`（アニメ-ジャンル表）
| 列名        | 意味                      |
|-------------|---------------------------|
| anime_id    | アニメID                  |
| anime_title | アニメタイトル            |
| genre       | ジャンル（カンマ区切り）  |

### 3. `anime_reviews.csv`（アニメ-レビュー表）
| 列名         | 意味                        |
|--------------|-----------------------------|
| anime_id     | アニメID                    |
| anime_title  | アニメタイトル              |
| review_score | レビュー平均点（例: 4.7）   |
| review_count | レビュー件数（例: 1200）    |

### 4. `user_history.csv`（ユーザー-視聴履歴）
| 列名    | 意味                        |
|---------|-----------------------------|
| user_id | ユーザーID                  |
| anime_id| アニメID                    |
| watched | 視聴済み:1, 未視聴:0         |

### 5. `similarity_results.csv`（ユーザー-キャラ類似度）
| 列名        | 意味                        |
|-------------|-----------------------------|
| user_id     | ユーザーID                  |
| character_id| キャラクターID              |
| similarity  | 類似度スコア（0〜1）        |

---

## プログラムの方向性

- ユーザーの推しキャラの平均顔画像の特徴量とアニメキャラの平均顔特徴量の類似度を計算（外部処理）
- 各キャラが登場するアニメ、ジャンル、レビュー情報を統合
- "推しになりうるキャラがいる未視聴アニメ"を、様々な観点からスコアリング
- 合成スコアでランキングし、レコメンド理由も詳細に表示

---

## アルゴリズム概要

1. **推しキャラ抽出**
    - similarity_results.csvから、ユーザーの推しキャラの平均顔特徴量と類似度が高いキャラ（閾値以上）を抽出
2. **未視聴アニメ抽出**
    - そのキャラが登場するアニメのうち、user_history.csvで未視聴のものを抽出
3. **アニメごとに集計**
    - 推し度（類似度合計・最大・平均）、推しキャラ数を計算
4. **情報付与**
    - ジャンル（anime_genres.csv）、レビュー点・件数（anime_reviews.csv）を付与
5. **正規化・重み付け**
    - 推し度・レビュー点を正規化
    - レビュー件数はlog重み
    - 推しキャラ数も加点
    - ユーザーがよく見るジャンルのアニメはさらに加点
6. **合成スコア計算**
    - 合成スコア = 推し度正規化×α + レビュー点正規化×β + 推しキャラ数×γ + レビュー件数重み×δ + ジャンル好みスコア×ε
7. **ランキング&出力**
    - 合成スコア順に並べ、詳細なレコメンド理由を表示

---

## 実行方法

### Docker利用
```sh
cd Recomend1
# ビルド
docker build -t recomend1-app .
# 実行
docker run --rm recomend1-app
```

### 直接実行
```sh
cd Recomend1
pip install -r requirements.txt
python main.py
```

---

## カスタマイズ例
- 各重み（ALPHA, BETA, GAMMA, DELTA, ジャンル好みスコアの係数）はmain.py内で調整可能
- 類似度の閾値も調整可能
- CSVを拡充すれば、より多様なアニメ・キャラ・ユーザーに対応可能

---

## 備考
- 類似度計算は本システム外で実施し、similarity_results.csvに結果を格納してください
- サンプルデータはダミーです。実運用時は実データで置き換えてください 